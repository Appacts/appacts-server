<?xml version="1.0"?>
<ReportDefinitionsSection>
    <ReportDefinitions>
        
        <ReportDefinition Name="Events" X="Events" XType="System.String" Y="Number of events" YType="System.Int32" Active="true">
            <Summary Guid="909E7EE3-872B-44AE-BDD7-3C4F4747A3C4" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Events" class="tile neutral">
                                <span class="value full">{{ValueOne}} <br/> events</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.EventSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            Counts : { $sum : "$Count" }
                                        }
                                }
                            ]);
                            
                            if(output.result.length == 0)
                                return;
                            
							return  { ValueOne :  output.result[0].Counts };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="50E8B11D-235C-4C77-8F7B-76E9C14F9B7E" ChartType="Bar" >
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.EventSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$ScreenEvents" },
                                {
                                    $group: 
                                        {
                                            _id : { Event: "$ScreenEvents.Event", Screen : "$ScreenEvents.Key" },
                                            Counts : { $sum : "$ScreenEvents.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										X : { $concat : ["$_id.Screen", "->", "$_id.Event"] },
										Y : "$Counts"
									}
								}
                            ]);
							
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
            <ReportComparePlatform Guid="B34C3B42-7ECC-4FE1-9051-B61F9CE3B77A" ChartType="Line">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate, platformIds) {
						
                            var platforms = db.Platform.find({ Type : { $in : platformIds }  }).toArray();
              
                            var hashMap = [];
                            for(var i = 0; i < platforms.length; i++) {
                                hashMap[platforms[i].Type] = platforms[i];
                            }
							
                            var output = db.EventSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId,
                                            PlatformId : { $in : platformIds }
                                        }
                                },
								{ $unwind : "$ScreenEvents" },
                                {
                                    $group: 
                                        {
                                            _id : { Event: "$ScreenEvents.Event", Screen : "$ScreenEvents.Key", PlatformId : "$PlatformId" },
                                            Counts : { $sum : "$ScreenEvents.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
                                        Name : "$_id.PlatformId",
										X : { $concat : ["$_id.Screen", "->", "$_id.Event"] },
										Y : "$Counts"
									}
								},
								{ $sort : { Name : 1, X : 1 } }
                            ]);
						    
							output = output.result;                            
							
                            var axisHashmap = []
							var axisArr = [];
                            for(var i = 0; i < output.length; i++) {
                                if(axisHashmap[output[i].X] == undefined) {
                                    axisHashmap[output[i].X] = {
                                        X : output[i].X,
                                        Y : 0
                                    }
									axisArr.push(axisHashmap[output[i].X]);
                                }
                            }

							
							var groups = [];	
							for(var i = 0; i < output.length; i++){
								if(groups[output[i].Name] == undefined) {
									groups[output[i].Name] = { 
										Name : hashMap[output[i].Name].Name,
										Axis : [],
										AxisHash : {}
									}
								
									for(var z = 0; z < axisArr.length; z++) {
										var axi = { X : axisArr[z].X, Y : 0 };
										groups[output[i].Name].AxisHash[axisArr[z].X] =  axi;
										groups[output[i].Name].Axis.push(axi);
									}
								}
								groups[output[i].Name].AxisHash[output[i].X].Y += output[i].Y;
							}
							
							return groups;
                        }
                    ]]>
                </Query>
            </ReportComparePlatform>
            <ReportCompareVersion Guid="26FA1318-5116-41C9-A8B0-2102B1EC3FF3" ChartType="Line">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate, versions) {
						 
                            var output = db.EventSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId,
                                            Version : { $in : versions }
                                        }
                                },
								{ $unwind : "$ScreenEvents" },
                                {
                                    $group: 
                                        {
                                            _id : { Event: "$ScreenEvents.Event", Screen : "$ScreenEvents.Key", Version : "$Version" },
                                            Counts : { $sum : "$ScreenEvents.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
                                        Name : "$_id.Version",
										X : { $concat : ["$_id.Screen", "->", "$_id.Event"] },
										Y : "$Counts"
									}
								},
								{ $sort : { Name : 1, X : 1 } }
                            ]);
							
							output = output.result;       
               
							
                            var axisHashmap = []
							var axisArr = [];
                            for(var i = 0; i < output.length; i++) {
                                if(axisHashmap[output[i].X] == undefined) {
                                    axisHashmap[output[i].X] = {
                                        X : output[i].X,
                                        Y : 0
                                    }
									axisArr.push(axisHashmap[output[i].X]);
                                }
                            }

							
							var groups = [];	
							for(var i = 0; i < output.length; i++){
								if(groups[output[i].Name] == undefined) {
									groups[output[i].Name] = { 
										Name : output[i].Name,
										Axis : [],
										AxisHash : {}
									}
								
									for(var z = 0; z < axisArr.length; z++) {
										var axi = { X : axisArr[z].X, Y : 0 };
										groups[output[i].Name].AxisHash[axisArr[z].X] =  axi;
										groups[output[i].Name].Axis.push(axi);
									}
								}
								groups[output[i].Name].AxisHash[output[i].X].Y += output[i].Y;
							}
							
							return groups;
                        }
                    ]]>
                </Query>
            </ReportCompareVersion>
        </ReportDefinition>

        <ReportDefinition Name="New vs returning" X="Date" XType="System.DateTime" Y="Number of users" YType="System.Int32" Active="true">
            <Summary Guid="C36F4780-6D00-431E-82F4-22D7088C00EA" Order="2" Type="ValueTwo" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Newvsreturning" class="tile neutral">
                                <span class="value full">New {{ValueOne}}% <br> Returning {{ValueTwo}}%</span> 
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            New : { $sum : "$NewReturningGroup.New" },
											Returning : { $sum : "$NewReturningGroup.Returning" },
											Total : { $sum : "$Count" }
                                        }
                                }
                            ]);
							
                            if(output.result.length == 0)
                                return;
							
							return  { 
									ValueOne :  Math.round((output.result[0].New / output.result[0].Total) * 100),
									ValueTwo : Math.round((output.result[0].Returning / output.result[0].Total) * 100)
								};
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="B5EBEAEA-7DA3-429D-90EE-559197642AE3" ChartType="Line" >
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$Date",
                                            New : { $sum : "$NewReturningGroup.New" },
											Returning : { $sum : "$NewReturningGroup.Returning" },
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										Date : "$_id",
										New : "$New",
										Returning : "$Returning",
										Total: "$Total"
									}
								}
                            ]);
		
                            if(output.result.length == 0)
                                return;
							
							output = output.result;
							
							var axisNew = [];
							var axisReturn = [];
							var axisOverall = [];
							
							for(var i = 0; i < output.length; i++){
								axisNew.push({ X : output[i].Date, Y : output[i].New });
								axisReturn.push({ X : output[i].Date, Y : output[i].Returning });
								axisOverall.push({ X : output[i].Date, Y : output[i].Total });
							}
							
                            var result = [];
							result[0] = { Name : 'New', Axis : axisNew };
							result[1] = { Name : 'Returning', Axis : axisReturn };
							result[2] = { Name : 'Overall', Axis : axisOverall };
							
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>
        
        <ReportDefinition Name="Screen used longest" X="Screen" XType="System.String" Y="Minutes average" YType="System.Int32" Active="true">
            <Summary Guid="4F2D9138-6CE8-44E5-8D57-A696BED54F51" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Screenusedlongest" class="tile neutral">
                                <span class="title full">Screen used the longest:</span>
                                <span class="value full">{{ValueOne}}</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.ScreenSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Durations" },
                                {
                                    $group: 
                                        {
                                            _id : "$Durations.Key",
                                            TotalSeconds : { $sum :  "$Durations.Seconds" },
											TotalCount : { $sum : "$Durations.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										X : "$_id",
										Y : { $multiply: ["$TotalSeconds", "$TotalCount"] }
									}
								},
                                { $sort : { Y : -1 } }
                            ]);
							
                            if(output.result.length == 0)
                                return;
							
                            return  { ValueOne :  output.result[0].X};
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="D1F8F242-03E6-44E7-98D7-A142FD0063B9" ChartType="Bar" >
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.ScreenSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Durations" },
                                {
                                    $group: 
                                        {
                                            _id : "$Durations.Key",
                                            TotalSeconds : { $sum :  "$Durations.Seconds" },
											TotalCount : { $sum : "$Durations.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										X : "$_id",
										Y : { 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : [{ $divide: ["$TotalSeconds", "$TotalCount"] }, 60] },
														0
													]  
											}
									}
								},
                                { $sort : { Y : -1 } }
                            ]);
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>
         
        <ReportDefinition Name="Feedback" X="Screen" XType="System.String" Y="Rating average" YType="System.Decimal" Active="true">
            <Summary Guid="B1358E56-9417-4A92-904E-9E6D61C48583" Order="1" Type="TrendAndValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Feedback" class="tile {{Trend}}">
                                <span class="title full">Feedback Rating:</span>
                                <div class="value full" style="margin-top:1px;">
                                    <div class="feedback_stars{{ValueOne}}"></div>
                                </div> 
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                            function(applicationId, startDate, endDate, startDateCompare, endDateCompare) {
                            var outputCurrent = db.FeedbackSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            TotalRatings : { $sum : "$SumOfRatings" },
											TotalCount : { $sum : "$Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										Y : { 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : ["$TotalRatings", "$TotalCount"]},
														0
													]  
											}
									}
								}
                            ]);
                            
                            if(outputCurrent.result.length == 0)
                                return;
                            
							outputCurrent = outputCurrent.result[0].Y;
							
                            var outputPast = db.FeedbackSummary.aggregate([
                                { 
                                    $match : 
                                        { 
											Date : { $gte: startDateCompare, $lte: endDateCompare },
											ApplicationId : applicationId
                                        }
                                },
                                   {
                                    $group: 
                                        {
                                            _id : null,
                                            TotalRatings : { $sum : "$SumOfRatings" },
											TotalCount : { $sum : "$Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										Y : { 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : ["$TotalRatings", "$TotalCount"]},
														0
													]  
											}
									}
								}
                            ]);
                            
                            if(outputPast.result.length != 0) {
							    outputPast = outputPast.result[0].Y;
							} else {
                                outputPast = 0;
                            }
							
                            var trend = 0;
                            if(outputCurrent > outputPast)
                                trend = 1
                            else if(outputCurrent < outputPast)
                                trend = 2
                            
                            return  { ValueOne :  Math.round(outputCurrent), TrendType : trend };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="A43B7B1C-ADB1-4401-935F-582F18CF74DD" ChartType="Bar">
                <Query>
                    <![CDATA[
                     function(applicationId, startDate, endDate) {
	                    var output = db.FeedbackSummary.aggregate([
		                    { 
			                    $match : 
				                    { 
					                    Date : { $gte: startDate, $lt: endDate },
					                    ApplicationId : applicationId
				                    }
		                    },
							{ $unwind : "$Ratings" },
		                    {
			                    $group: 
				                    {
					                    _id : "$Ratings.Key",
					                    TotalRatings : { $sum : "$Ratings.Rating" },
					                    TotalCount : { $sum : "$Ratings.Count" }
				                    }
		                    },
		                    {
			                    $project :
			                    {
				                    _id : 0,
				                    X : "$_id",
				                    Y :  { 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : ["$TotalRatings", "$TotalCount"]},
														0
													]  
										}
			                    }
		                    }
	                    ]);

	                    var result = [];
	                    result[0] = { Name : 'Default', Axis : output.result };
	                    return result;
                    }
                    ]]>
                </Query>
                <Detail Guid="0D478221-301A-45A6-AA73-AABDB1104572">
                    <Template>
                        <![CDATA[
                            <script id="template" type="text/template">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><span>Date</span></th>
                                            <th><span>Rating</span></th>
                                            <th><span>Message</span></th>
                                            <th><span>App Version</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#Data}}
                                        <tr>
                                            <td>{{#dtcd}}{{#formatDate}}{{$date}}{{/formatDate}}{{/dtcd}}</td>
                                            <td>{{rat}}</td>
                                            <td>{{msg}}</td>
                                            <td>{{ver}}</td>
                                        </tr>
                                        {{/Data}}
                                    </tbody>
                                </table>
                            </script>
                        ]]>                        
                    </Template>
                    <Query>
                        <![CDATA[
                             function(applicationId, startDate, endDate, screen) {
	                            var output = db.Feedback.find({
					                            dt : { $gte: startDate, $lt: endDate },
					                            appId : applicationId,
										        scrn : screen
										        }, {
											        appId : 0,
											        ses : 0,
											        devId : 0,
											        pltId : 0,
											        dt : 0,
											        dtc : 0
										        }).toArray();
					
						        return { Data : output };
                            }
                        ]]>
                    </Query>
                </Detail>
            </ReportNormal>
        </ReportDefinition>
     
        <ReportDefinition Name="How fast content loads" X="Content" XType="System.String" Y="Seconds average" YType="System.Decimal" Active="true">
            <Summary Guid="C6227C9B-850B-49F8-AE8B-1BBB7B2E0420" Order="1" Type="TrendAndValueOne">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Howfastcontentloads" class="tile_with_filter {{Trend}}">
                                <div class="filterContantLoadTime">
                                    <span class="title">Content load speed:</span>
                                    <div class="value"> 
                                        {{ValueOne}} / sec
                                    </div>
                                </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate, startDateCompare, endDateCompare) {
                            var outputCurrent = db.ContentLoadSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Loads" },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            TotalSeconds : { $sum : "$Loads.Seconds" },
											TotalCount : { $sum : "$Loads.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										Y :  
											{ 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : ["$TotalSeconds", "$TotalCount"]},
														0
													]  
											}
									}
								}
                            ]);

                            if(outputCurrent.result.length == 0)
                                return;
							
							outputCurrent = outputCurrent.result[0].Y;
							
                            var outputPast = db.ContentLoadSummary.aggregate([
                                { 
                                    $match : 
                                        { 
											Date : { $gte: startDateCompare, $lte: endDateCompare },
											ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Loads" },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            TotalSeconds : { $sum : "$Loads.Seconds" },
											TotalCount : { $sum : "$Loads.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										Y :  
											{ 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : ["$TotalSeconds", "$TotalCount"]},
														0
													]  
											}
									}
								}
                            ]);
                            
                            if(outputPast.result.length != 0) {
							    outputPast = outputPast.result[0].Y;
							} else {
                                outputPast = 0;
                            }
							
                            var trend = 0;
                            if(outputCurrent > outputPast)
                                trend = 1
                            else if(outputCurrent < outputPast)
                                trend = 2
                            
                            return  { ValueOne :  Math.round(outputCurrent), TrendType : trend };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="F80AA8C7-1EF6-4873-85B5-67907D02914C" ChartType="Bar" >
                <Query>
                    <![CDATA[
                            function(applicationId, startDate, endDate) {
                            var output = db.ContentLoadSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Loads" },
                                {
                                    $group: 
                                        {
                                            _id :  { Content : "$Loads.Content", Screen : "$Loads.Key" }, 
                                            TotalSeconds : { $sum : "$Loads.Seconds" },
											TotalCount : { $sum : "$Loads.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										X : { $concat : ["$_id.Screen", " -> ", "$_id.Content"] },
										Y :  
											{ 
												$cond: 
													[
														{ $ne : ["$TotalCount", 0] }, 
														{ $divide : ["$TotalSeconds", "$TotalCount"]},
														0
													]  
											}
									}
								}
                            ]);


                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
						}
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Errors" X="Screen" XType="System.String" Y="Number of errors" YType="System.Int32" Active="true">
            <Summary Guid="1ECED9FF-11F0-469A-99C5-4D33C2111F5E" Order="1" Type="TrendAndValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Errors" class="tile {{Trend}}">
                                   <span class="value full">{{ValueOne}} <br /> errors catched</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                        function(applicationId, startDate, endDate, startDateCompare, endDateCompare) {
                            var outputCurrent = db.ErrorSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            Y : { $sum : "$Count" }
                                        }
                                }
                            ]);

                            if(outputCurrent.result.length == 0)
                                return;
					
							outputCurrent = outputCurrent.result[0].Y;
                    
                            var outputPast = db.ErrorSummary.aggregate([
                                { 
                                    $match : 
                                        { 
											Date : { $gte: startDateCompare, $lte: endDateCompare },
											ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
                                            Y : { $sum : "$Count" }
                                        }
                                }
                            ]);

                            if(outputPast.result.length != 0) {
							    outputPast = outputPast.result[0].Y;
							} else {
                                outputPast = 0;
                            }
						
                            var trend = 0;
                            if(outputCurrent > outputPast)
                                trend = 1
                            else if(outputCurrent < outputPast)
                                trend = 2
                           
                            return  { ValueOne :  outputCurrent, TrendType : trend };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="7DB85161-859E-45E4-826B-1A5E9503101B" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.ErrorSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$ScreenErrors" },
                                {
                                    $group: 
                                        {
                                            _id : "$ScreenErrors.Key",
                                            Counts : { $sum : "$ScreenErrors.Count" }
                                        }
                                },
								{
									$project :
									{
										_id : 0,
										X : "$_id",
										Y : "$Counts"
									}
								}
                            ]);
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
                <Detail Guid="491DB928-6C48-429D-B435-1BE25A5A96C1">
                    <Template>
                        <![CDATA[
                            <script id="template" type="text/template">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><span>Date</span></th>
                                            <th><span>Event</span></th>
                                            <th><span>Message</span></th>
                                            <th><span>Stack Trace</span></th>
                                            <th><span>Data</span></th>
                                            <th><span>App Version</span></th>
                                            <th><span>Platform</span></th>
                                            <th><span>Model</span></th>
                                            <th><span>OS Version</span></th>
                                            <th><span>Battery</span></th>
                                            <th><span>AVAL RAM</span></th>
                                            <th><span>AVAL HD</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {{#Data}}
                                        <tr>
                                            <td>{{#dt}}{{#formatDate}}{{$date}}{{/formatDate}}{{/dt}}</td>
                                            <td>{{evtnm}}</td>
                                            <td>{{msg}}</td>
                                            <td>{{stktr}}</td>
                                            <td>{{data}}</td>
                                            <td>{{ver}}</td>
                                            <td>{{pltId}}</td>
                                            <td>{{model}}</td>
                                            <td>{{osver}}</td>
                                            <td>{{btr}}</td>
                                            <td>{{avlmemsz}}</td>
                                            <td>{{avldrvsz}}</td>
                                        </tr>
                                    {{/Data}}
                                    </tbody>
                                </table>
                            </script>
                        ]]>
                    </Template>
                    <Query>
                        <![CDATA[
                         function(applicationId, startDate, endDate, screenName) {
                            var output = db.Error.find(
                                { 
									dt : { $gte: startDate, $lte: endDate },
									appId : applicationId,
									scrn : screenName
                                },
								{
									_id : 0,
									ses : 0,
									devId : 0,
									pltId : 0,
									dtcd : 0,
									dtc : 0,
									appId : 0,
									scrn : 0
								}
                            ).toArray();
			
                            return { Data : output};
                        }
                        ]]>
                    </Query>
                </Detail>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Day of week used" X="Day of week" XType="System.String" Y="Number of times used" YType="System.Int32" Active="true">
            <Summary Guid="3C2A8668-E093-487B-839D-2B330A82C524" Order="1" Type="ValueTwo" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Dayofweekused" class="tile_with_filter neutral">
                                <div class="filter{{ValueOne}}">
                                    <span class="title full" style="line-height:15px;">Most popular <br/> day of the week:</span>
                                </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											Mon : { $sum : "$WeekGroup.Mon" },
											Tue : { $sum : "$WeekGroup.Tue" },
											Wed : { $sum : "$WeekGroup.Wed" },
											Thu : { $sum : "$WeekGroup.Thu" },
											Fri : { $sum : "$WeekGroup.Fri" },
											Sat : { $sum : "$WeekGroup.Sat" },
                                            Sun : { $sum : "$WeekGroup.Sun" }
                                        }
                                }
                            ]);
						
                             if(output.result.length == 0)
                                return;
                        
							var weekRange = 
								[
									{ X : "Monday" , Y : output.result[0].Mon  },
									{ X : "Tuesday" , Y : output.result[0].Tue },
									{ X : "Wednesday", Y : output.result[0].Wed },
									{ X : "Thursday", Y : output.result[0].Thu },
									{ X : "Friday", Y : output.result[0].Fri },
									{ X : "Saturday", Y : output.result[0].Sat },
									{ X : "Sunday", Y : output.result[0].Sun }
								];
								
							weekRange.sort(function(a, b) { return b.Y - a.Y });
								
                             return  { ValueOne :  weekRange[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="10CAE358-A557-4AC8-86A0-9CF42B356D3D" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											Mon : { $sum : "$WeekGroup.Mon" },
											Tue : { $sum : "$WeekGroup.Tue" },
											Wed : { $sum : "$WeekGroup.Wed" },
											Thu : { $sum : "$WeekGroup.Thu" },
											Fri : { $sum : "$WeekGroup.Fri" },
											Sat : { $sum : "$WeekGroup.Sat" },
                                            Sun : { $sum : "$WeekGroup.Sun" }
                                        }
                                }
                            ]);
						
							var weekRange = 
								[
									{ X : "Monday" , Y : output.result[0].Mon  },
									{ X : "Tuesday" , Y : output.result[0].Tue },
									{ X : "Wednesday", Y : output.result[0].Wed },
									{ X : "Thursday", Y : output.result[0].Thu },
									{ X : "Friday", Y : output.result[0].Fri },
									{ X : "Saturday", Y : output.result[0].Sat },
									{ X : "Sunday", Y : output.result[0].Sun }
								];
								
                            var result = [];
                            result[0] = { Name : 'Default', Axis : weekRange };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="How often used" X="Time between each use" XType="System.String" Y="Number of users" YType="System.Int32" Active="true">
            <Summary Guid="E7F71CF0-5A73-4F03-BE74-DCFE5C8F9308" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Howoftenused" class="tile neutral">
                                    <span class="title full">How often used:</span> 
                                    <span class="value full">{{ValueOne}}</span> 
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_24hrs : { $sum : "$FrequencyUsageGroup._24hrs" },
											_1day : { $sum : "$FrequencyUsageGroup._1day" },
											_2days : { $sum : "$FrequencyUsageGroup._2days" },
											_3days : { $sum : "$FrequencyUsageGroup._3days" },
											_4days : { $sum : "$FrequencyUsageGroup._4days" },
											_5days : { $sum : "$FrequencyUsageGroup._5days" },
                                            _6days : { $sum : "$FrequencyUsageGroup._6days" },
											_1wk : { $sum : "$FrequencyUsageGroup._1wk" },
											_2wk : { $sum : "$FrequencyUsageGroup._2wk" },
											_3wk : { $sum : "$FrequencyUsageGroup._3wk" },
											_1mt : { $sum : "$FrequencyUsageGroup._1mt" },
											Over1Mt : { $sum : "$FrequencyUsageGroup.Over1Mt" },
                                        }
                                }
                            ]);
						
                            if(output.result.length == 0)
                                return;
                        
							var freqRange = 
								[
									{ X : "1-24 hours" , Y : output.result[0]._24hrs  },
									{ X : "1 day" , Y : output.result[0]._1day },
									{ X : "2 days", Y : output.result[0]._2days },
									{ X : "3 days", Y : output.result[0]._3days },
									{ X : "4 days", Y : output.result[0]._4days },
									{ X : "5 days", Y : output.result[0]._5days },
									{ X : "6 days", Y : output.result[0]._6days },
									{ X : "1 week" , Y : output.result[0]._1wk  },
									{ X : "2weeks" , Y : output.result[0]._2wk },
									{ X : "3 weeks", Y : output.result[0]._3wk },
									{ X : "1 month", Y : output.result[0]._1mt },
									{ X : "1 month+", Y : output.result[0].Over1Mt }
								];
								
							freqRange.sort(function(a, b) { return b.Y - a.Y });
								
                             return  { ValueOne :  freqRange[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="0D5E7BB1-4AA2-4DE9-B816-E33F17A5A49F" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_24hrs : { $sum : "$FrequencyUsageGroup._24hrs" },
											_1day : { $sum : "$FrequencyUsageGroup._1day" },
											_2days : { $sum : "$FrequencyUsageGroup._2days" },
											_3days : { $sum : "$FrequencyUsageGroup._3days" },
											_4days : { $sum : "$FrequencyUsageGroup._4days" },
											_5days : { $sum : "$FrequencyUsageGroup._5days" },
                                            _6days : { $sum : "$FrequencyUsageGroup._6days" },
											_1wk : { $sum : "$FrequencyUsageGroup._1wk" },
											_2wk : { $sum : "$FrequencyUsageGroup._2wk" },
											_3wk : { $sum : "$FrequencyUsageGroup._3wk" },
											_1mt : { $sum : "$FrequencyUsageGroup._1mt" },
											Over1Mt : { $sum : "$FrequencyUsageGroup.Over1Mt" },
                                        }
                                }
                            ]);
						
                             if(output.result.length == 0)
                                return;
                        
							var freqRange = 
								[
									{ X : "1-24 hours" , Y : output.result[0]._24hrs  },
									{ X : "1 day" , Y : output.result[0]._1day },
									{ X : "2 days", Y : output.result[0]._2days },
									{ X : "3 days", Y : output.result[0]._3days },
									{ X : "4 days", Y : output.result[0]._4days },
									{ X : "5 days", Y : output.result[0]._5days },
									{ X : "6 days", Y : output.result[0]._6days },
									{ X : "1 week" , Y : output.result[0]._1wk  },
									{ X : "2weeks" , Y : output.result[0]._2wk },
									{ X : "3 weeks", Y : output.result[0]._3wk },
									{ X : "1 month", Y : output.result[0]._1mt },
									{ X : "1 month+", Y : output.result[0].Over1Mt }
								];
								
                            var result = [];
                            result[0] = { Name : 'Default', Axis : freqRange };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Hour of day used" X="Hour of the day" XType="System.TimeSpan" Y="Number of times used" Active="true">
            <Summary Guid="C1CDA962-A592-47F3-9A96-ADB3C5529A9E" Order="1" Type="ValueOne">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Hourofdayused" class="tile_with_filter neutral">
                                <div class="filterTimeOfDay">
                                    <span class="title full">Most popular hour:</span> 
                                    <span class="value"> {{ValueOne}} </span>
                                </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_0 : { $sum : "$TimeGroup._0" },
											_1 : { $sum : "$TimeGroup._1" },
											_2 : { $sum : "$TimeGroup._2" },
											_3 : { $sum : "$TimeGroup._3" },
											_4 : { $sum : "$TimeGroup._4" },
											_5 : { $sum : "$TimeGroup._5" },
                                            _6 : { $sum : "$TimeGroup._6" },
											_7 : { $sum : "$TimeGroup._7" },
											_8 : { $sum : "$TimeGroup._8" },
											_9 : { $sum : "$TimeGroup._9" },
											_10 : { $sum : "$TimeGroup._10" },
											_11 : { $sum : "$TimeGroup._11" },
											_12 : { $sum : "$TimeGroup._12" },
                                            _13 : { $sum : "$TimeGroup._13" },
											_14 : { $sum : "$TimeGroup._14" },
											_15 : { $sum : "$TimeGroup._15" },
											_16 : { $sum : "$TimeGroup._16" },
											_17 : { $sum : "$TimeGroup._17" },
											_18 : { $sum : "$TimeGroup._18" },
											_19 : { $sum : "$TimeGroup._19" },
                                            _20 : { $sum : "$TimeGroup._20" },
											_21 : { $sum : "$TimeGroup._21" },
											_22 : { $sum : "$TimeGroup._22" },
                                            _23 : { $sum : "$TimeGroup._23" },
                                        }
                                }
                            ]);
						
                            if(output.result.length == 0)
                                return;
                        
							var weekRange = 
								[
									{ X : "00:00" , Y : output.result[0]._0  },
									{ X : "01:00" , Y : output.result[0]._1 },
									{ X : "02:00", Y : output.result[0]._2 },
									{ X : "03:00", Y : output.result[0]._3 },
									{ X : "04:00", Y : output.result[0]._4 },
									{ X : "05:00", Y : output.result[0]._5 },
									{ X : "06:00", Y : output.result[0]._6 },
									{ X : "07:00" , Y : output.result[0]._7  },
									{ X : "08:00" , Y : output.result[0]._8 },
									{ X : "09:00", Y : output.result[0]._9 },
									{ X : "10:00", Y : output.result[0]._10 },
									{ X : "11:00", Y : output.result[0]._11 },
									{ X : "12:00", Y : output.result[0]._12 },
									{ X : "13:00", Y : output.result[0]._13 },
									{ X : "14:00" , Y : output.result[0]._14  },
									{ X : "15:00" , Y : output.result[0]._15 },
									{ X : "16:00", Y : output.result[0]._16 },
									{ X : "17:00", Y : output.result[0]._17 },
									{ X : "18:00", Y : output.result[0]._18 },
									{ X : "19:00", Y : output.result[0]._19 },
									{ X : "20:00", Y : output.result[0]._20 },
									{ X : "21:00" , Y : output.result[0]._21  },
									{ X : "22:00" , Y : output.result[0]._22 },
									{ X : "23:00", Y : output.result[0]._23 }
								];
								
							weekRange.sort(function(a, b) { return b.Y - a.Y });
								
                             return  { ValueOne :  weekRange[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="2E31FE56-C3C9-4B13-9224-E702D82504AD" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_0 : { $sum : "$TimeGroup._0" },
											_1 : { $sum : "$TimeGroup._1" },
											_2 : { $sum : "$TimeGroup._2" },
											_3 : { $sum : "$TimeGroup._3" },
											_4 : { $sum : "$TimeGroup._4" },
											_5 : { $sum : "$TimeGroup._5" },
                                            _6 : { $sum : "$TimeGroup._6" },
											_7 : { $sum : "$TimeGroup._7" },
											_8 : { $sum : "$TimeGroup._8" },
											_9 : { $sum : "$TimeGroup._9" },
											_10 : { $sum : "$TimeGroup._10" },
											_11 : { $sum : "$TimeGroup._11" },
											_12 : { $sum : "$TimeGroup._12" },
                                            _13 : { $sum : "$TimeGroup._13" },
											_14 : { $sum : "$TimeGroup._14" },
											_15 : { $sum : "$TimeGroup._15" },
											_16 : { $sum : "$TimeGroup._16" },
											_17 : { $sum : "$TimeGroup._17" },
											_18 : { $sum : "$TimeGroup._18" },
											_19 : { $sum : "$TimeGroup._19" },
                                            _20 : { $sum : "$TimeGroup._20" },
											_21 : { $sum : "$TimeGroup._21" },
											_22 : { $sum : "$TimeGroup._22" },
                                            _23 : { $sum : "$TimeGroup._23" },
                                        }
                                }
                            ]);
						
							var timeRange = 
								[
									{ X : "00:00" , Y : output.result[0]._0  },
									{ X : "01:00" , Y : output.result[0]._1 },
									{ X : "02:00", Y : output.result[0]._2 },
									{ X : "03:00", Y : output.result[0]._3 },
									{ X : "04:00", Y : output.result[0]._4 },
									{ X : "05:00", Y : output.result[0]._5 },
									{ X : "06:00", Y : output.result[0]._6 },
									{ X : "07:00" , Y : output.result[0]._7  },
									{ X : "08:00" , Y : output.result[0]._8 },
									{ X : "09:00", Y : output.result[0]._9 },
									{ X : "10:00", Y : output.result[0]._10 },
									{ X : "11:00", Y : output.result[0]._11 },
									{ X : "12:00", Y : output.result[0]._12 },
									{ X : "13:00", Y : output.result[0]._13 },
									{ X : "14:00" , Y : output.result[0]._14  },
									{ X : "15:00" , Y : output.result[0]._15 },
									{ X : "16:00", Y : output.result[0]._16 },
									{ X : "17:00", Y : output.result[0]._17 },
									{ X : "18:00", Y : output.result[0]._18 },
									{ X : "19:00", Y : output.result[0]._19 },
									{ X : "20:00", Y : output.result[0]._20 },
									{ X : "21:00" , Y : output.result[0]._21  },
									{ X : "22:00" , Y : output.result[0]._22 },
									{ X : "23:00", Y : output.result[0]._23 }
								];

                            var result = [];
                            result[0] = { Name : 'Default', Axis : timeRange };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="How long used for" X="Time intervals" XType="System.TimeSpan" Y="Percentage &#37;" 
                          YType="System.Int32" YY="Number of times used" YYType="System.Int32" Active="true">
            <Summary Guid="716FA236-5E61-41C1-B506-CC6B7C42469F" Order="1" Type="ValueOne">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Howlongusedfor" class="tile neutral">
                                <span class="title">Most popular session time: </span>
                                <span class="value">{{ValueOne}}</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageDurationSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_10sec : { $sum : "$LengthGroup._10sec" },
											_20sec : { $sum : "$LengthGroup._20sec" },
											_30sec: { $sum : "$LengthGroup._30sec" },
											_1min : { $sum : "$LengthGroup_1min" },
											_2min : { $sum : "$LengthGroup._2min" },
											_4min : { $sum : "$LengthGroup._4min" },
                                            _8min : { $sum : "$LengthGroup._8min" },
											_16min : { $sum : "$LengthGroup._16min" },
											_32min : { $sum : "$LengthGroup._32min" },
											_1hr : { $sum : "$LengthGroup._1hr" },
											Over1hr: { $sum : "$LengthGroup.Over1hr" },
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										_10sec : { $multiply : [ { $divide : ["$_10sec", "$Total"] } , 100] },
										_20sec : { $multiply : [ { $divide : ["$_20sec", "$Total"] }, 100] },
										_30sec: { $multiply : [ { $divide : ["$_30sec", "$Total"] }, 100] },
										_1min : { $multiply : [ { $divide : ["$_1min", "$Total"] }, 100] },
										_2min : { $multiply : [ { $divide : ["$_2min", "$Total"] } , 100] },
										_4min : { $multiply : [ { $divide : ["$_4min", "$Total"] }, 100] },
										_8min : { $multiply : [ { $divide : ["$_8min", "$Total"] }, 100] },
										_16min : { $multiply : [ { $divide : ["$_16min", "$Total"] }, 100] },
										_32min : { $multiply : [ { $divide : ["$_32min", "$Total"] }, 100] },
										_1hr : { $multiply : [ { $divide : ["$_1hr", "$Total"] } , 100] },
										Over1hr: { $multiply : [ { $divide : ["$Over1hr", "$Total"] } , 100] }
									}
								}
                            ]);
							
                            if(output.result.length == 0)
                                return;
                            
							var sessionRange = 
								[
									{ X : "10 seconds" , Y : output.result[0]._10sec },
									{ X : "20 seconds" , Y : output.result[0]._20sec },
									{ X : "30 seconds", Y : output.result[0]._30sec },
									{ X : "1 min", Y : output.result[0]._1min },
									{ X : "2 min", Y : output.result[0]._2min },
									{ X : "4 min", Y : output.result[0]._4min },
									{ X : "8 min", Y : output.result[0]._8min },
									{ X : "16 min" , Y : output.result[0]._16min  },
									{ X : "32 min" , Y : output.result[0]._32min },
									{ X : "1 hour", Y : output.result[0]._1hr },
									{ X : "Over 1 hour", Y : output.result[0].Over1hr }
								];

							sessionRange.sort(function(a, b) { return b.Y - a.Y });
								
                            return  { ValueOne : sessionRange[0].X }; 
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="952183BE-CFE4-40A5-906A-0A7223E6D8EA" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageDurationSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_10sec : { $sum : "$LengthGroup._10sec" },
											_20sec : { $sum : "$LengthGroup._20sec" },
											_30sec: { $sum : "$LengthGroup._30sec" },
											_1min : { $sum : "$LengthGroup_1min" },
											_2min : { $sum : "$LengthGroup._2min" },
											_4min : { $sum : "$LengthGroup._4min" },
                                            _8min : { $sum : "$LengthGroup._8min" },
											_16min : { $sum : "$LengthGroup._16min" },
											_32min : { $sum : "$LengthGroup._32min" },
											_1hr : { $sum : "$LengthGroup._1hr" },
											Over1hr: { $sum : "$LengthGroup.Over1hr" },
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										_10sec : { $multiply : [ { $divide : ["$_10sec", "$Total"] } , 100] },
										_20sec : { $multiply : [ { $divide : ["$_20sec", "$Total"] }, 100] },
										_30sec: { $multiply : [ { $divide : ["$_30sec", "$Total"] }, 100] },
										_1min : { $multiply : [ { $divide : ["$_1min", "$Total"] }, 100] },
										_2min : { $multiply : [ { $divide : ["$_2min", "$Total"] } , 100] },
										_4min : { $multiply : [ { $divide : ["$_4min", "$Total"] }, 100] },
										_8min : { $multiply : [ { $divide : ["$_8min", "$Total"] }, 100] },
										_16min : { $multiply : [ { $divide : ["$_16min", "$Total"] }, 100] },
										_32min : { $multiply : [ { $divide : ["$_32min", "$Total"] }, 100] },
										_1hr : { $multiply : [ { $divide : ["$_1hr", "$Total"] } , 100] },
										Over1hr: { $multiply : [ { $divide : ["$Over1hr", "$Total"] } , 100] }
									}
								}
                            ]);
							
							var sessionRange = 
								[
									{ X : "10 seconds" , Y : output.result[0]._10sec },
									{ X : "20 seconds" , Y : output.result[0]._20sec },
									{ X : "30 seconds", Y : output.result[0]._30sec },
									{ X : "1 min", Y : output.result[0]._1min },
									{ X : "2 min", Y : output.result[0]._2min },
									{ X : "4 min", Y : output.result[0]._4min },
									{ X : "8 min", Y : output.result[0]._8min },
									{ X : "16 min" , Y : output.result[0]._16min  },
									{ X : "32 min" , Y : output.result[0]._32min },
									{ X : "1 hour", Y : output.result[0]._1hr },
									{ X : "Over 1 hour", Y : output.result[0].Over1hr }
								];


                            var result = [];
                            result[0] = { Name : 'Default', Axis : sessionRange };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Sessions" X="Date" XType="System.DateTime" Y="Number of times used" YType="System.Int32" Active="true">
            <Summary Guid="C3912AF3-A7D9-4ADF-9516-AC2449B43E65" Order="1" Type="TrendAndValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Sessions" class="tile {{Trend}}">
                                <span class="value full">{{ValueOne}} <br /> sessions</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                        function(applicationId, startDate, endDate, startDateCompare, endDateCompare) {
							
							var outputCurrent = 
								db.AppUsageSummary.aggregate([
								{
									$match : 
									{
										Date : { $gte: startDate, $lte: endDate },
										ApplicationId : applicationId
									}
								},
								{
									$group : 
									{
										_id : null,
										Y : { $sum : "$Count" }
									}
								}
							]);
                            if(outputCurrent.result.length == 0)
                                return;
                            
							outputCurrent = outputCurrent.result[0].Y;
							
							var outputPast = 
								db.AppUsageSummary.aggregate([
								{
									$match : 
									{
										Date : { $gte: startDateCompare, $lte: endDateCompare },
										ApplicationId : applicationId
									}
								},
								{
									$group : 
									{
										_id : null,
										Y : { $sum : "$Count" }
									}
								}
							]);
                            
                            if(outputPast.result.length != 0) {
							    outputPast = outputPast.result[0].Y;
							} else {
                                outputPast = 0;
                            }
							
                            var trend = 0;
                            if(outputCurrent > outputPast)
                                trend = 1
                            else if(outputCurrent < outputPast)
                                trend = 2
                            
                            return  { ValueOne :  parseInt(outputCurrent), TrendType : trend };
                        }
                    ]]>  
                </Query>
            </Summary>
            <ReportNormal Guid="D256457F-F9F3-4295-BDC1-33F97B785942" ChartType="Line">
                <Query>
                    <![CDATA[
                        function(applicationId, startDate, endDate) {
							var output = 
								db.AppUsageSummary.aggregate([
								{
									$match : 
									{
										Date : { $gte: startDate, $lt: endDate },
										ApplicationId : applicationId
									}
								},
								{
									$group : 
									{
										_id: "$Date",
										Y : { $sum : "$Count" }
									}
								},
								{ $sort : { _id : -1 } },
								{
									$project : 
									{
										_id : 0,
										X : "$_id",
										Y : "$Y"
									}
								}
							]);
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Crash" X="Date" XType="System.DateTime" Y="Number of crashes" YType="System.Int32" Active="true">
            <Summary Guid="A4D3605B-A623-448C-9B30-496C05C88083" Order="1" Type="TrendAndValueOne">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Crash" class="tile_with_filter {{Trend}}">
                                <div class="filterCrashes">
                                    <span class="title">Number of crashes:</span> 
                                    <span class="value full">{{ValueOne}}</span>
                                </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
 function(applicationId, startDate, endDate, startDateCompare, endDateCompare) {
                            var outputCurrent = db.CrashSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											Y : { $sum : "$Count" }
                                        }
                                }
                            ]);
                            
                            if(outputCurrent.result.length == 0)
                                return;
                            
							outputCurrent = outputCurrent.result[0].Y;
							
                            var outputPast = db.CrashSummary.aggregate([
                                { 
                                    $match : 
                                        { 
											Date : { $gte: startDateCompare, $lte: endDateCompare },
											ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : null,
											Y : { $sum : "$Count" }
                                        }
                                }
                            ]);
                            
                            if(outputPast.result.length != 0) {
							    outputPast = outputPast.result[0].Y;
							} else {
                                outputPast = 0;
                            }
							
							
                            var trend = 0;
                            if(outputCurrent > outputPast)
                                trend = 1
                            else if(outputCurrent < outputPast)
                                trend = 2
                            
                            return  { ValueOne :  parseInt(outputCurrent), TrendType : trend };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="A62425D4-F588-455B-954A-206BAC0B53A4" ChartType="Line">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.CrashSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$Date",
											Y : { $sum : "$Count" }
                                        }
                                },
                                {
                                    $project : 
                                    {
                                        _id : 0,
                                        X : "$_id",
                                        Y : "$Y"
                                    }
                                },
								{ $sort : { X : 1 } }
                            ]);

                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
                <Detail Guid="6D48975C-8577-4C8C-901B-75CA90E78BC1">
                    <Template>
                        <![CDATA[
                            <script id="template" type="text/template">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><span>Date</span></th>
                                            <th><span>Last screen visited</span></th>
                                            <th><span>Platform</span></th>
                                            <th><span>Model</span></th>
                                            <th><span>App Version</span></th>
                                            <th><span>OS Version</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {{#Data}}
                                        <tr>
                                            <td>{{#dt}}{{#formatDate}}{{$date}}{{/formatDate}}{{/dt}}</td>
                                            <td>{{lstscrn}}</td>
                                            <td>{{pltId}}</td>
                                            <td>{{model}}</td>
                                            <td>{{ver}}</td>
                                            <td>{{osVer}}</td>
                                        </tr>
                                    {{/Data}}
                                    </tbody>
                                </table>
                            </script>
                        ]]>
                    </Template>
                    <Query>
                        <![CDATA[
                         function(applicationId, startDate, endDate, dateString) {

                            var dateSplit = dateString.split("/");
                            var date = new Date(Date.UTC(dateSplit[2], dateSplit[1] - 1, dateSplit[0]));

                            var output = db.Crash.find(
                                { 
									dt :  date,
									appId : applicationId
                                },
                                {
									_id : 0
                                }).toArray();

                            return { Data : output };
                        }
                        ]]>
                    </Query>
                </Detail>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Age" X="Age groups" XType="System.String" Y="Percentage &#37;" YType="System.Int32" 
                          YY="Number of users" YYType="System.Int32" Active="True">
            <Summary Guid="A4026968-E658-4636-8C59-6391C6AC3BA6" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                    <script id="template" type="text/template">
                        <div id="Age" class="tile neutral">
                            <span class="title full">Most popular age:</span>
                            <span class="value full">{{ValueOne}}</span>
                        </div>
                    </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUserSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Users" },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_1_18 : { $sum : "$Users.AgeGroup._1_18" },
											_19_24 : { $sum : "$Users.AgeGroup._19_24" },
											_25_35: { $sum : "$Users.AgeGroup._25_35" },
											_36_50 : { $sum : "$Users.AgeGroup._36_50" },
											_51_69 : { $sum : "$Users.AgeGroup._51_69" },
											_71 : { $sum : "$Users.AgeGroup._71" },
											Total : { $sum : "$Users.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										_1_18 : { $multiply : [ { $divide : ["$_1_18", "$Total"] } , 100] },
										_19_24 : { $multiply : [ { $divide : ["$_19_24", "$Total"] }, 100] },
										_25_35: { $multiply : [ { $divide : ["$_25_35", "$Total"] }, 100] },
										_36_50 : { $multiply : [ { $divide : ["$_36_50", "$Total"] }, 100] },
										_51_69: { $multiply : [ { $divide : ["$_51_69", "$Total"] } , 100] },
										_71 : { $multiply : [ { $divide : ["$_71", "$Total"] }, 100] }
									}
								}
                            ]);
							
							if(output.result.length == 0)
								return null;
							
							var ageRange = 
								[
									{ X : "1 - 18" , Y : output.result[0]._1_18 },
									{ X : "19 - 24" , Y : output.result[0]._19_24 },
									{ X : "25 - 35", Y : output.result[0]._25_35 },
									{ X : "36 - 50", Y : output.result[0]._36_50 },
									{ X : "51 - 69", Y : output.result[0]._51_69 },
									{ X : "71+", Y : output.result[0]._71 }
								];

							ageRange.sort(function(a, b) { return b.Y - a.Y });
								
                            return  { ValueOne : ageRange[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="776C72E4-D108-4808-8570-63717A0DA48B" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUserSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Users" },
                                {
                                    $group: 
                                        {
                                            _id : null,
											_1_18 : { $sum : "$Users.AgeGroup._1_18" },
											_19_24 : { $sum : "$Users.AgeGroup._19_24" },
											_25_35: { $sum : "$Users.AgeGroup._25_35" },
											_36_50 : { $sum : "$Users.AgeGroup._36_50" },
											_51_69 : { $sum : "$Users.AgeGroup._51_69" },
											_71 : { $sum : "$Users.AgeGroup._71" },
											Total : { $sum : "$Users.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										_1_18 : { $multiply : [ { $divide : ["$_1_18", "$Total"] } , 100] },
										_19_24 : { $multiply : [ { $divide : ["$_19_24", "$Total"] }, 100] },
										_25_35: { $multiply : [ { $divide : ["$_25_35", "$Total"] }, 100] },
										_36_50 : { $multiply : [ { $divide : ["$_36_50", "$Total"] }, 100] },
										_51_69: { $multiply : [ { $divide : ["$_51_69", "$Total"] } , 100] },
										_71 : { $multiply : [ { $divide : ["$_71", "$Total"] }, 100] }
									}
								}
                            ]);
							
							if(output.result.length == 0)
								return null;
							
							var ageRange = 
								[
									{ X : "1 - 18" , Y : output.result[0]._1_18 },
									{ X : "19 - 24" , Y : output.result[0]._19_24 },
									{ X : "25 - 35", Y : output.result[0]._25_35 },
									{ X : "36 - 50", Y : output.result[0]._36_50 },
									{ X : "51 - 69", Y : output.result[0]._51_69 },
									{ X : "71+", Y : output.result[0]._71 }
								];

                            var result = [];
                            result[0] = { Name : 'Default', Axis : ageRange };
                            return result; 
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Location" X="Country" XType="System.String" Y="Number of users" YType="System.Int32" Active="False">
            <Summary Guid="6BA32AA9-BE4F-4261-8967-FD0AF6F5805E" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                    <script id="template" type="text/template">
                        <div id="PopularCountry"  class="tile neutral">
                            <span class="title">Popular country:</span>
                            <div class="value"> {{ValueOne}} </div>
                        </div>
                    </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[

                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="578B12A4-BBA6-4FFB-94FF-FC6E4ECCFF95" ChartType="Bar"  />
        </ReportDefinition>

        <ReportDefinition Name="Gender" X="Gender" XType="System.String" Y="Number of users" YType="System.Int32" Active="true">
            <Summary Guid="6F98B765-D4C5-429F-8047-BBAC45E2124E" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Gender" class="tile neutral">
                                <span class="title full">Mostly used by:</span>
                                <div class="value full">
                                    {{ValueOne}}
                                </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUserSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Users" },
                                {
                                    $group: 
                                        {
                                            _id : "$Users.Key",
											Total : { $sum : "$Users.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
						
							if(output.result.length == 0)
								return null;
							
							var group = [];
							group[1] = "Male";
							group[2] = "Female"
							group[3] = "Unknown";
							
							var axis = [];
							for(var i = 0; i < output.result.length; i++){
								axis.push({ X : group[output.result[i].X], Y : output.result[i].Y })
							}

							axis.sort(function(a, b) { return b.Y - a.Y });
								
                            return  { ValueOne : axis[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="1915C347-3A93-4D71-9715-9FBEE2E6B8C9" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUserSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Users" },
                                {
                                    $group: 
                                        {
                                            _id : "$Users.Key",
											Total : { $sum : "$Users.Count" },
											Overall : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total",
										Total : "$Overall"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
				
							if(output.result.length == 0)
								return null;
							
							var group = [];
							group[1] = "Male";
							group[2] = "Female"
							group[3] = "Unknown";
							
							var axis = [];
							for(var i = 0; i < output.result.length; i++){
								axis.push({ 
									X : group[output.result[i].X], 
									Y : (output.result[i].Y / output.result[i].Total) * 100
								})
							}
								
                            var result = [];
                            result[0] = { Name : 'Default', Axis : axis };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Manufacturer" X="Manufacturer" XType="System.String" Y="Percentage &#37;" 
                          YType="System.Int32" YY="Number of devices" YYType="System.Int32" Active="true">
            <Summary Guid="83775D78-3085-4504-A9EC-9AC4022F1AD9" Order="1" Type="ValueOne">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Manufacturer" class="tile neutral">
                               <span class="title full" style="line-height:15px;margin-bottom:3px;">Trending manufacturer:</span> 
                               <span class="value">{{ValueOne}}</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$ManufacturerModels" },
                                {
                                    $group: 
                                        {
                                            _id : "$ManufacturerModels.Key",
											Total : { $sum : "$ManufacturerModels.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
                            return  { ValueOne : output.result[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="F28D0066-068A-4EC4-B37B-DCC67ECCEAED" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$ManufacturerModels" },
                                {
                                    $group: 
                                        {
                                            _id : "$ManufacturerModels.Key",
											Total : { $sum : "$ManufacturerModels.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
							var total = 0;
							for(var i = 0; i < output.result.length; i++) {
								total += output.result[i].Y;
							}
							
							var manufacturers = [];
							for(var i = 0; i < output.result.length; i++) {
								manufacturers[i] = output.result[i];
								manufacturers[i].Y = (manufacturers[i].Y / total) * 100;
							}
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : manufacturers };
                            return result;
                        }
                    ]]>
                </Query>
                <Detail Guid="4975D2AA-8E31-4874-BC95-C4C0E4D75DE0">
                    <Template>
                        <![CDATA[
                            <script id="template" type="text/template">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><span>Model</span></th>
                                            <th><span>Number of devices</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#Data}}
                                        <tr>
                                            <td>{{Item1}}</td>
                                            <td>{{Item2}}</td>
                                        </tr>
                                        {{/Data}}
                                    </tbody>
                                </table>
                            </script>
                        ]]>
                    </Template>
                    <Query>
                        <![CDATA[
                         function(applicationId, startDate, endDate, manufac) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$ManufacturerModels" },
								{
									$match  :
									{
										"ManufacturerModels.Key" : manufac
									}
								},
                                {
                                    $group: 
                                        {
                                            _id : "$ManufacturerModels.Model",
											Total : { $sum : "$ManufacturerModels.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										Item1 : "$_id",
										Item2 : "$Total"
									}
								},
								{ $sort : { Item2 : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;

						
                            return { Data : output.result };
                        }
                        ]]>
                    </Query>
                </Detail>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Platform" X="Platform" XType="System.String" Y="Percentage &#37;" 
                          YType="System.Int32" YY="Number of devices" YYType="System.Int32" Active="true">
            <Summary Guid="9C78CE69-4568-40C6-BCE1-1A884219B5A2" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Platform" class="tile_with_filter neutral">
                                <div class="filterPlatform">
                                    <span class="title">Most popular platform:</span>
                                    <span class="value">{{ValueOne}}</span>
                                </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$PlatformId",
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
							var platform = 
								db.Platform.findOne({ Type : output.result[0].X });
							
                            return  { ValueOne : platform.Name };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="5EDBC08A-544A-4500-9DF9-DED4D9DD6A71" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$PlatformId",
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
						
							var platforms = db.Platform.find().toArray();
						
							var dict = [];
							for(var i = 0; i < platforms.length; i++) {
								dict[platforms[i].Type] = platforms[i].Name;
							}
							
							var total = 0;
							for(var i = 0; i < output.result.length; i++) {
								total += output.result[i].Y;
							}
							
							var axis = [];
							for(var i = 0; i < output.result.length; i++) {
								axis[i] = output.result[i];
								axis[i].X = dict[axis[i].X];
								axis[i].Y = (axis[i].Y / total) * 100;
							}
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : axis };
                            return result;
                        }
                    ]]> 
                </Query>
                <Detail Guid="111F3DD9-8EF4-450E-A382-F7C6F7A3F11C">
                    <Template>
                        <![CDATA[
                            <script id="template" type="text/template">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><span>OS Version</span></th>
                                            <th><span>Number of devices</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#Data}}
                                        <tr>
                                            <td>{{Item1}}</td>
                                            <td>{{Item2}}</td>
                                        </tr>
                                        {{/Data}}
                                    </tbody>
                                </table>
                            </script>
                        ]]>
                    </Template>
                    <Query>
                        <![CDATA[
                         function(applicationId, startDate, endDate, platformName) {
                            var platform = db.Platform.findOne({ Name : platformName });
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId,
											PlatformId : platform.Type
                                        }
                                },
								{ $unwind : "$OperatingSystems" },
                                {
                                    $group: 
                                        {
                                            _id : "$OperatingSystems.Key",
											Total : { $sum : "$OperatingSystems.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										Item1 : "$_id",
										Item2 : "$Total"
									}
								},
								{ $sort : { Item2 : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
                            return { Data : output.result };
                        }
                        ]]>
                    </Query>
                </Detail>    
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Carrier" X="Carrier" XType="System.String" Y="Percentage &#37;" YType="System.Int32" 
                          YY="Number of devices" YYType="System.Int32" Active="true">
            <Summary Guid="5B9FF146-86F5-4246-B80F-A9466ED7ED70" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Carrier" class="tile_with_filter neutral">
                                <div class="filterCarrier">
                                     <span class="title full">Most popular carrier:</span>
                                     <span class="value full">{{ValueOne}}</span>
                                 </div>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Carriers" },
                                {
                                    $group: 
                                        {
                                            _id : "$Carriers.Key",
											Total : { $sum : "$Carriers.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
				
							if(output.result.length == 0)
								return null;
							
                            return  { ValueOne :  output.result[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="3404ABA2-0135-4DA2-8328-FD42943AC2A6" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Carriers" },
                                {
                                    $group: 
                                        {
                                            _id : "$Carriers.Key",
											Total : { $sum : "$Carriers.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : 1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
							var total = 0;
							for(var i = 0; i < output.result.length; i++) {
								total += output.result[i].Y;
							}
							
							var carriers = [];
							for(var i = 0; i < output.result.length; i++) {
								carriers[i] = output.result[i];
								carriers[i].Y = (carriers[i].Y / total) * 100;
							}
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : carriers };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Version" X="Versions" XType="System.String" Y="Percentage &#37;" YType="System.Int32" 
                          YY="Number of devices" YYType="System.Int32" Active="true">
            <Summary Guid="CDE25DC9-02AF-4963-AD81-428C2299124E" Order="1" Type="ValueTwo">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Version" class="tile neutral">
                                <span class="title">Most popular version:</span> 
                                <span class="value">{{ValueOne}} - {{ValueTwo}}%</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var outputRegistrations = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lt: endDate },
                                            ApplicationId : applicationId,
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$Version" ,
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
                            var outputUpgrades = db.DeviceUpgradeSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lt: endDate },
                                            ApplicationId : applicationId,
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$Version" ,
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
							if(outputRegistrations.result.length == 0 &&
								outputUpgrades.result.length == 0) 
								return;
						
							var arr = [];
							arr = outputRegistrations.result.concat(outputUpgrades.result);
							
							var group = {};
							var groupMax = 0;
							var groupMaxName = "";
                            var total = 0;
							for (var i = arr.length; --i >= 0;) {
							  var y = arr[i].Y;
							  var x = arr[i].X;
							  var n = group[x] = y - -(group[x] | 0);
                              total += y;
							  if (n > groupMax) { groupMax = n; groupMaxName = x; }
							}

                            return  { ValueOne : groupMaxName, ValueTwo :Math.round((groupMax / total) * 100) };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="13895B9C-4FDD-44A6-BD25-6193D62B66CE" ChartType="Pie">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var outputRegistrations = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lt: endDate },
                                            ApplicationId : applicationId,
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$Version" ,
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
                            var outputUpgrades = db.DeviceUpgradeSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lt: endDate },
                                            ApplicationId : applicationId,
                                        }
                                },
                                {
                                    $group: 
                                        {
                                            _id : "$Version" ,
											Total : { $sum : "$Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
							if(outputRegistrations.result.length == 0 &&
								outputUpgrades.result.length == 0) 
								return;
						
							var arr = {};
							arr = outputRegistrations.result.concat(outputUpgrades.result);
							
							var group = {};
							var groupDictionary = {};
							var groupList = [];
							var totalCount = 0;
							for (var i = arr.length; --i >= 0;) {
							  var y = arr[i].Y;
							  var x = arr[i].X;
							  
							  var groupValue = group[x] | 0;	  
							  var n = group[x] = y- -groupValue;
					
							  if(groupValue == 0) {
								var object =  { 
									X : x, 
									Y : n, 
									YY : 0									
								};
								groupList.push(object);
								groupDictionary[x] = object;
							  } else {
								groupDictionary[x].Y = n;
							  }
							 
							  totalCount += y; 
							}
						
							for(var i = 0; i < groupList.length; i++) {
								groupList[i].YY = groupList[i].Y;
								groupList[i].Y = Math.round((groupList[i].Y / totalCount) * 100);
							}

                            var result = [];
                            result[0] = { Name : 'Default', Axis : groupList };
                            return result; 
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Most popular exit screen" X="Screen" XType="System.String" 
                          Y="Number of exits" Active="true">
            <Summary Guid="C957BF35-2CB0-489C-9AA4-FC774F37BD0D" Order="1" Type="ValueOne" >
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Mostpopularexitscreen" class="tile neutral">
                                <span class="title">Most popular exit screen:</span> 
                                <span class="value">{{ValueOne}}</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.ScreenRouteSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte : endDate },
                                            ApplicationId : applicationId,
											"ScreenRoutes.B" : "",
                                            "ScreenRoutes.A" : { $ne : null  }
                                        }
                                },
								{ $unwind: "$ScreenRoutes" },
                                {
                                    $group: 
                                        {
                                            _id : "$ScreenRoutes.A",
											Total : { $sum : "$ScreenRoutes.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return;
								
                            return  { ValueOne : output.result[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="B1F62F54-86B2-4B68-A4C3-9B9E7CF63A67" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.ScreenRouteSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte : endDate },
                                            ApplicationId : applicationId,
											"ScreenRoutes.B" : "",
                                            "ScreenRoutes.A" : { $ne : null  }
                                        }
                                },
								{ $unwind: "$ScreenRoutes" },
                                {
                                    $group: 
                                        {
                                            _id : "$ScreenRoutes.A",
											Total : { $sum : "$ScreenRoutes.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
						
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>
    
        <ReportDefinition Name="Loyalty" X="Number of times used" XType="System.String" Y="Number of users" Active="true">
            <Summary Guid="D6C70CDD-D3F8-4BAD-AEB4-A1E2C558E7F5" Order="1" Type="ValueTwo">
                <Template>
                    <![CDATA[
                        <script id="template" type="text/template">
                            <div id="Loyalty" class="tile neutral">
                               <span class="title full" style="line-height:15px;margin-bottom:3px;">Trending loyalty usage:</span> 
                               <span class="value">{{ValueOne}}</span>
                            </div>
                        </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId,
                                        }
                                },
								{ $unwind: "$DevicesVisits" },
                                {
                                    $group: 
                                        {
                                            _id : "$DevicesVisits.DeviceId" ,
											Count : { $sum : "$DevicesVisits.Count" }
                                        }
                                },
								{
									$group:
									{
										_id : "$Count",
										TotalCount : { $sum : "$Count" }
									}
								},
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$TotalCount"
									}
								}
                            ]);
                            
 							if(output.result.length == 0)
								return null;
                            
							var output = output.result;
							
							var rangeMatch = function(x, max, min) {
								return x >= min && x <= max;
							};
							
							var group = [
								{  Max : 1, Min : 1 },
								{  Max : 2, Min : 2 },
								{  Max : 5, Min : 3 },
								{  Max : 9, Min : 6 },
								{  Max : 10, Min: 19 },
								{  Max : 49, Min: 20 },
								{  Max : 99, Min: 50 },
								{  Max : 199, Min: 100 },
								{  Max : 499, Min: 200 },
								{  Max: 999999999, Min: 500 }
							];
						
							var axis = [
								{ X: "Once", Y : 0 },
								{ X: "Twice", Y : 0  },
								{ X: "3-5", Y : 0 },
								{ X: "6-9", Y : 0  },
								{ X: "10-19", Y : 0  },
								{ X: "20-49", Y : 0 },
								{ X: "50-99", Y : 0 },
								{ X: "100-199", Y : 0 },
								{ X: "200-499", Y : 0 },
								{ X: "500+", Y : 0 }
							];
						
							for(var i = 0; i < output.length; i++) {
								for(var z = 0; z < group.length; z++) {
									if(rangeMatch(output[i].X, group[z].Max, group[z].Min)) {
										axis[z].Y += output[i].Y;
										break;
									}
								}
							}
						
							axis.sort(function(a, b) { return b.Y - a.Y });
							return  { ValueOne :  axis[0].X };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="C6B35AD1-7C25-436C-A14B-0FBC0844D340" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.AppUsageSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId,
                                        }
                                },
								{ $unwind: "$DevicesVisits" },
                                {
                                    $group: 
                                        {
                                            _id : "$DevicesVisits.DeviceId" ,
											Count : { $sum : "$DevicesVisits.Count" }
                                        }
                                },
								{
									$group:
									{
										_id : "$Count",
										TotalCount : { $sum : "$Count" }
									}
								},
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$TotalCount"
									}
								}
                            ]);
							var output = output.result;
							
							var rangeMatch = function(x, max, min) {
								return x >= min && x <= max;
							};
							
							var group = [
								{  Max : 1, Min : 1 },
								{  Max : 2, Min : 2 },
								{  Max : 5, Min : 3 },
								{  Max : 9, Min : 6 },
								{  Max : 10, Min: 19 },
								{  Max : 49, Min: 20 },
								{  Max : 99, Min: 50 },
								{  Max : 199, Min: 100 },
								{  Max : 499, Min: 200 },
								{  Max: 999999999, Min: 500 }
							];
						
							var axis = [
								{ X: "Once", Y : 0 },
								{ X: "Twice", Y : 0  },
								{ X: "3-5", Y : 0 },
								{ X: "6-9", Y : 0  },
								{ X: "10-19", Y : 0  },
								{ X: "20-49", Y : 0 },
								{ X: "50-99", Y : 0 },
								{ X: "100-199", Y : 0 },
								{ X: "200-499", Y : 0 },
								{ X: "500+", Y : 0 }
							];
						
							for(var i = 0; i < output.length; i++) {
								for(var z = 0; z < group.length; z++) {
									if(rangeMatch(output[i].X, group[z].Max, group[z].Min)) {
										axis[z].Y += output[i].Y;
										break;
									}
								}
							}
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : axis };
                            return result; 
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Locale" X="Locale" XType="System.String" Y="Number of devices" Active="true">
            <Summary Guid="DAF55CF0-598D-45C6-9BAE-2CC795401FF0" Order="1" Type="ValueOne">
                <Template>
                    <![CDATA[
                    <script id="template" type="text/template">
                        <div id="Locale" class="tile neutral">
                           <span class="title full" style="line-height:15px;margin-bottom:3px;">Users speak in:</span> 
                           <span class="value">{{ValueOne}} language(s)</span>
                        </div>
                    </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Locales" },
                                {
                                    $group: 
                                        {
                                            _id : "$Locales.Key",
											Total : { $sum : 1 }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
                            return  { ValueOne :  output.result.length };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="5DBBA958-E6D3-45A4-80AC-30BAA6D35425" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind : "$Locales" },
                                {
                                    $group: 
                                        {
                                            _id : "$Locales.Key",
											Total : { $sum : "$Locales.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>

        <ReportDefinition Name="Screen resolutions" X="Resolution" XType="System.String" Y="Number of devices" Active="true">
            <Summary Guid="C90EE132-43C5-4A57-BCF1-623BD59F84BE" Order="1" Type="ValueOne">
                <Template>
                    <![CDATA[
                    <script id="template" type="text/template">
                        <div id="Screenresolutions" class="tile neutral">
                           <span class="title full" style="line-height:15px;margin-bottom:3px;">Number of resolutions:</span> 
                           <span class="value">{{ValueOne}}</span>
                        </div>
                    </script>
                        ]]>
                </Template>
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind: "$Resolutions" },
                                {
                                    $group: 
                                        {
                                            _id : "$Resolutions.WxH",
											Total : { $sum : "$Resolutions.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { Y : -1 } }
                            ]);
							
							if(output.result.length == 0)
								return null;
							
                            return  { ValueOne : output.result.length };
                        }
                    ]]>
                </Query>
            </Summary>
            <ReportNormal Guid="C486AC71-36C6-4A1F-AB74-C407CD104909" ChartType="Bar">
                <Query>
                    <![CDATA[
                         function(applicationId, startDate, endDate) {
                            var output = db.DeviceSummary.aggregate([
                                { 
                                    $match : 
                                        { 
                                            Date : { $gte: startDate, $lte: endDate },
                                            ApplicationId : applicationId
                                        }
                                },
								{ $unwind: "$Resolutions" },
                                {
                                    $group: 
                                        {
                                            _id : "$Resolutions.WxH",
											Total : { $sum : "$Resolutions.Count" }
                                        }
                                },
								{
									$project:
									{
										_id : 0,
										X : "$_id",
										Y : "$Total"
									}
								},
								{ $sort : { X : 1 } }
                            ]);
						
                            var result = [];
                            result[0] = { Name : 'Default', Axis : output.result };
                            return result;
                        }
                    ]]>
                </Query>
            </ReportNormal>
        </ReportDefinition>
        
    </ReportDefinitions>
</ReportDefinitionsSection>